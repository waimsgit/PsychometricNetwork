<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>订单支付</title>
		<link rel="stylesheet" type="text/css" href="css/commone.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/video.css" />
		<link rel="stylesheet" type="text/css" href="css/videoOrderform.css" />
		<script src="js/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script src="js/public.js"></script>
	</head>

	<body>
		<div class="main">
		<div class="container">
			<!--左边导航内容-->
			<div id="side"></div>

			<div class="right" id="order">
				<div class="orderform">
					<div class="ordertop">
						<div class="ordertop-center">
							<ul>
								<li><span>1</span> <span>订单确认</span> <span>.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.</span></li>
								<li><span>2</span> <span>订单支付</span> <span>.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.&nbsp;&nbsp;.</span></li>
								<li><span>3</span> <span>订单完成</span></li>
							</ul>
						</div>
					</div>
					
					<div class="orderbottom" >
						<p>订单已提交，请在24小时内完成支付，逾期订单将自动取消。</p>
						<div class="orderbox">
							<div class="orderimg">
								<img :src="img" alt="" />
							</div>
							<div class="ordermessage">
								<p>订单号：<span>{{ordernumber}}</span></p>
								<p>订单名称：<span>{{title}}</span></p>
								<p>订单金额：<span>{{price}}</span></p>
							</div>
							<p class="payway">————&nbsp;&nbsp;&nbsp;&nbsp;支付方式&nbsp;&nbsp;&nbsp;&nbsp;————</p>
							<img src="img/videopay.png" alt="" class="wechatpay"/>
						</div>
					</div>
					
					<div class="wechatcode">
						<p class="close">X</p>
						<img :src="qrcode" alt="" />
						<p>{{price}}</p>
						<p>请用微信扫码支付</p>
					</div>
				</div>
			</div>  <!--right的结尾标签-->
			<div class="clear"></div>
		</div>
		<!--container的结尾标签-->
        			
		</div>  <!--main的结尾标签-->
		
		<!--版权-->
		<div class="right-footer">
			<div class="right-footer-content">
				骄阳智心 版权所有 2010-2019&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;京ICP备17000866&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;京公网安备11010802023632号
			</div>
		</div>

        
        <!--引入公共部分的js-->
		<script>
			$(function(){
				$("#side").load("side.html",function(){
			 		$("#icon4").attr("src","img/icon4_4.png");
			 	});
			 	
			 	var vm = new Vue({
			 		el: "#order",
					data: {
						"ordernumber":'',
						"title":'',
						"img":"",
						"price":"",
						"qrcode":""
					},
					methods:{}
			 	});
			 	console.log(getUrlParam("id"))
			 	vm.ordernumber = getUrlParam("id");
			 	vm.img = getUrlParam("img");
			 	vm.title = getUrlParam("title");
			 	vm.price = getUrlParam("price");
			 	var url1 = geturl();
				$.ajax({
					"url": url1 + "/scale/get/qecode",
					"data":{"out_trade_no":vm.ordernumber,"rechargeMoney":vm.price.replace(/[^0-9]/ig,""),"body":vm.title},
					"datatype": "json",
					headers:{'token':'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOlsiMTg1MTEwMTQ2NjJAMTYzLmNvbSIsIjgiXX0.Ekotd0bKVCz6YA1kZUgu5xNgouAHa714nz9VNOs_Lsc'},
					"success": function(result){
						console.log(result)
						vm.qrcode = result.message;
					}
				})
				load(vm.ordernumber)
				//二维码弹框
				$(".wechatpay").click(function(){
					$(".wechatcode").show()
				})
				$(".close").click(function(){
					$(".wechatcode").hide()
				})
				
			})
			function getUrlParam(name) {              //name是路径参数名称
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
				var r = decodeURI(window.location.search).substr(1).match(reg);
				if (r != null) return unescape(r[2]); return null;
			}
			
			function load(sid){
		    		var socket = null;
		    		//建立连接
		    		if('WebSocket' in window){
		    			socket = new WebSocket("ws://192.168.1.145:8886/scale/websocket/"+sid);
		    			//打开事件  
		            socket.onopen = function() {  
		                console.log("Socket 已打开");  
		                //socket.send("这是来自客户端的消息" + location.href + new Date());  
		            };  
		            //获得消息事件  
		            socket.onmessage = function(msg) {  
		                console.log(msg.data);  
		                //发现消息进入    开始处理前端触发逻辑
		            };  
		            //关闭事件  
		            socket.onclose = function() {  
		                console.log("Socket已关闭");  
		            };  
		            //发生了错误事件  
		            socket.onerror = function() {  
		                alert("Socket发生了错误");  
		                //此时可以尝试刷新页面
		            }  
	
		    		}else{
		    			alert("浏览器不兼容，请更换浏览器")
		    		}
		    }
		</script>
   </body>
</html>